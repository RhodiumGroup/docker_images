sudo: required
services:
  - docker

env: 
  - TAG=2018-07-11.01

install:
  - cd notebook
  - docker build -t rhodium/notebook:$TAG .
  - cd ../worker
  - docker build -t rhodium/worker:$TAG .
  - cd ../worker-tc
  - docker build -t rhodium/worker-tc:$TAG .

script:
  - docker images rhodium/notebook:$TAG
  - docker images rhodium/worker:$TAG
  - docker images rhodium/worker:$TAG

before_deploy:
  - docker login -u "$DOCKER_USERNAME" -p "$DOCKER_PASSWORD"
deploy:
  provider: script
  script: 
    - docker push "rhodium/notebook:$TAG"
    - docker push "rhodium/worker:$TAG"
    - docker push "rhodium/worker:$TAG"
  on:
    branch: master
